<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä Student Dashboard ‚Äî Yor's Road to Manga</title>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&family=DM+Mono:ital,wght@0,400;0,500;1,400&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0a0f;--bg2:#0f0f1a;--surface:#141420;--surface2:#1a1a28;
  --border:#232338;--border2:#2e2e4a;
  --sakura:#e8547a;--sakura2:#f07090;--sakura3:#ffa0b8;
  --gold:#d4a83a;--gold2:#f0c84c;
  --jade:#2db87e;--jade2:#4dd9a0;
  --blue:#4a8fff;--purple:#9b7aff;--red:#e05c4a;--red2:#ff7060;
  --text:#c8c8e8;--text2:#7a7a9a;--text3:#3a3a5a;
  --white:#f0f0ff;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'Outfit','Sarabun',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{
  content:'';position:fixed;inset:0;
  background:
    radial-gradient(ellipse 80% 60% at 100% 0%,rgba(232,84,122,.07),transparent 60%),
    radial-gradient(ellipse 50% 40% at 0% 100%,rgba(45,184,126,.05),transparent 60%),
    radial-gradient(ellipse 40% 30% at 50% 50%,rgba(212,168,58,.03),transparent 60%);
  pointer-events:none;z-index:0;
  animation:bgShift 20s ease-in-out infinite alternate;
}
@keyframes bgShift{0%{opacity:1}100%{opacity:.6;transform:scale(1.05)}}
.wrap{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 24px 80px}

/* HEADER */
header{
  padding:40px 0 32px;border-bottom:1px solid var(--border);margin-bottom:40px;
  display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:20px;
}
.back-btn{
  display:inline-flex;align-items:center;gap:7px;
  font-family:'DM Mono';font-size:11px;color:var(--text3);
  text-decoration:none;letter-spacing:1px;text-transform:uppercase;
  border:1px solid var(--border2);padding:7px 14px;border-radius:8px;
  transition:all .2s;margin-bottom:16px;
}
.back-btn:hover{color:var(--sakura);border-color:var(--sakura);background:rgba(232,84,122,.06)}
.continue-btn{
  background:linear-gradient(135deg,var(--sakura),var(--sakura2)) !important;
  color:#fff !important;border-color:transparent !important;
  font-weight:700;
}
.continue-btn:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(232,84,122,.4);color:#fff !important}
.hd-title{font-family:'Shippori Mincho';font-size:36px;font-weight:800;color:var(--white);letter-spacing:2px;line-height:1}
.hd-sub{font-size:11px;color:var(--text3);font-family:'DM Mono';letter-spacing:3px;text-transform:uppercase;margin-top:6px}
.hd-desc{font-size:14px;color:var(--text2);margin-top:10px;line-height:1.6}

/* STAT CARDS ROW */
.stat-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px;margin-bottom:40px}
.stat-card{
  background:var(--surface);border:1px solid var(--border);border-radius:16px;
  padding:18px 20px;position:relative;overflow:hidden;
}
.stat-card::before{content:'';position:absolute;top:-20px;right:-20px;width:80px;height:80px;border-radius:50%;opacity:.08;pointer-events:none}
.sc-sakura::before{background:var(--sakura)}
.sc-gold::before{background:var(--gold)}
.sc-jade::before{background:var(--jade)}
.sc-blue::before{background:var(--blue)}
.sc-purple::before{background:var(--purple)}
.stat-num{font-family:'Shippori Mincho';font-size:34px;font-weight:800;line-height:1;margin-bottom:4px}
.stat-lbl{font-size:10px;color:var(--text3);font-family:'DM Mono';letter-spacing:2px;text-transform:uppercase}
.stat-sub{font-size:12px;color:var(--text2);margin-top:5px}

/* SECTION LABEL */
.section-label{font-size:10px;color:var(--text3);letter-spacing:3px;text-transform:uppercase;font-family:'DM Mono';margin-bottom:16px;display:flex;align-items:center;gap:8px}
.section-label::after{content:'';flex:1;height:1px;background:var(--border)}
.section-wrap{margin-bottom:44px}

/* CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:24px}
.card-title{font-size:14px;font-weight:700;color:var(--white);margin-bottom:18px;display:flex;align-items:center;gap:8px}
.card-desc{font-size:12px;color:var(--text2);margin-top:-12px;margin-bottom:18px;line-height:1.6}

/* HEATMAP */
.heatmap-wrap{overflow-x:auto;padding-bottom:8px}
.heatmap-grid{display:flex;gap:3px;min-width:fit-content}
.hm-col{display:flex;flex-direction:column;gap:3px}
.hm-cell{
  width:13px;height:13px;border-radius:2px;
  background:var(--surface2);border:1px solid rgba(255,255,255,.04);
  cursor:default;transition:transform .1s;flex-shrink:0;position:relative;
}
.hm-cell:hover{transform:scale(1.4);z-index:10}
.hm-cell.studied{background:rgba(232,84,122,.8);border-color:rgba(232,84,122,.4)}
.hm-cell.studied-recent{background:var(--sakura);border-color:var(--sakura2);box-shadow:0 0 6px rgba(232,84,122,.4)}
.hm-labels-months{display:flex;gap:3px;margin-bottom:4px;min-width:fit-content;height:14px;position:relative}
.hm-month-label{font-size:9px;font-family:'DM Mono';color:var(--text3);position:absolute;white-space:nowrap}
.hm-day-labels{display:flex;flex-direction:column;gap:3px;margin-right:6px;flex-shrink:0;padding-top:0}
.hm-day-label{height:13px;font-size:9px;font-family:'DM Mono';color:var(--text3);display:flex;align-items:center;white-space:nowrap}
.heatmap-footer{display:flex;align-items:center;gap:8px;margin-top:12px;font-size:11px;color:var(--text3);font-family:'DM Mono'}
.hm-legend{display:flex;gap:3px;align-items:center}
.hm-leg-cell{width:11px;height:11px;border-radius:2px}

/* TOOLTIP */
.hm-tooltip{
  display:none;position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);
  background:var(--surface2);border:1px solid var(--border2);border-radius:6px;
  padding:4px 8px;font-size:10px;font-family:'DM Mono';color:var(--text);
  white-space:nowrap;pointer-events:none;z-index:100;
}
.hm-cell:hover .hm-tooltip{display:block}
/* Flip tooltip downward for top 2 rows */
.hm-cell.row-top .hm-tooltip{
  bottom:auto;top:calc(100% + 6px);
}

/* GRAMMAR BARS */
.grammar-sections{display:flex;flex-direction:column;gap:16px}
.gs-row{display:flex;flex-direction:column;gap:6px}
.gs-header{display:flex;justify-content:space-between;align-items:center}
.gs-name{font-size:13px;font-weight:600;color:var(--white);display:flex;align-items:center;gap:8px}
.gs-pct{font-family:'DM Mono';font-size:13px;font-weight:600}
.gs-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.gs-fill{height:100%;border-radius:3px;transition:width .8s cubic-bezier(.4,.2,.2,1)}
.gs-tip{font-size:11px;color:var(--text2);margin-top:2px}
.gs-badge{
  font-size:9px;font-family:'DM Mono';letter-spacing:1px;font-weight:700;
  padding:2px 8px;border-radius:6px;text-transform:uppercase;
}
.badge-great{background:rgba(45,184,126,.2);color:var(--jade2);border:1px solid rgba(45,184,126,.3)}
.badge-ok{background:rgba(212,168,58,.15);color:var(--gold2);border:1px solid rgba(212,168,58,.3)}
.badge-weak{background:rgba(224,92,74,.15);color:var(--red2);border:1px solid rgba(224,92,74,.3)}

/* LAPSE TRACKER */
.lapse-list{display:flex;flex-direction:column;gap:8px}
.lapse-row{
  display:flex;align-items:center;gap:14px;
  background:var(--surface);border:1px solid var(--border);border-radius:12px;
  padding:12px 16px;position:relative;overflow:hidden;
  transition:border-color .2s;
}
.lapse-row:hover{border-color:var(--border2)}
.lapse-row::before{
  content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:2px 0 0 2px;
}
.lapse-rank{
  font-family:'DM Mono';font-size:11px;color:var(--text3);
  width:20px;text-align:center;flex-shrink:0;
}
.lapse-rank.top3{font-weight:700}
.lapse-jp{font-family:'Shippori Mincho';font-size:22px;color:var(--white);font-weight:700;flex-shrink:0;min-width:55px}
.lapse-kana{font-size:11px;color:var(--text2);font-family:'Shippori Mincho';flex-shrink:0;min-width:70px}
.lapse-th{font-size:13px;color:var(--text);flex:1}
.lapse-type{font-size:9px;font-family:'DM Mono';letter-spacing:1px;padding:2px 7px;border-radius:5px;flex-shrink:0;text-transform:uppercase}
.tag-noun{background:rgba(74,143,255,.15);color:var(--blue);border:1px solid rgba(74,143,255,.3)}
.tag-verb{background:rgba(45,184,126,.12);color:var(--jade2);border:1px solid rgba(45,184,126,.25)}
.tag-adj{background:rgba(155,122,255,.15);color:var(--purple);border:1px solid rgba(155,122,255,.3)}
.tag-adv{background:rgba(212,168,58,.12);color:var(--gold2);border:1px solid rgba(212,168,58,.25)}
.tag-expr{background:rgba(224,92,74,.12);color:var(--red2);border:1px solid rgba(224,92,74,.25)}
.lapse-count{
  font-family:'DM Mono';font-size:13px;font-weight:700;
  min-width:36px;text-align:right;flex-shrink:0;
}
.lapse-bar-bg{
  height:3px;background:var(--border);border-radius:2px;overflow:hidden;
  position:absolute;bottom:0;left:0;right:0;
}
.lapse-bar-fill{height:100%;border-radius:2px}
.lapse-empty{
  text-align:center;padding:36px 24px;
  background:rgba(45,184,126,.05);border:1px dashed rgba(45,184,126,.2);border-radius:12px;
}
.lapse-empty .icon{font-size:36px;margin-bottom:10px}
.lapse-empty .msg{font-size:14px;color:var(--jade2);font-weight:600}
.lapse-empty .sub{font-size:12px;color:var(--text2);margin-top:6px}

/* TWO-COL GRID */
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:768px){.two-col{grid-template-columns:1fr}}

/* EMPTY STATE */
.empty-state{text-align:center;padding:40px 24px;color:var(--text2);font-size:13px}
.empty-state .icon{font-size:32px;margin-bottom:10px;opacity:.5}

/* ANIM */
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.anim{animation:slideUp .5s ease forwards;opacity:0}
.anim-1{animation-delay:.05s}.anim-2{animation-delay:.15s}.anim-3{animation-delay:.25s}.anim-4{animation-delay:.35s}

/* NOTIF */
.notif{position:fixed;bottom:18px;right:18px;background:var(--surface2);border:1px solid var(--border2);border-radius:12px;padding:12px 18px;font-size:13px;z-index:999;transform:translateY(60px);opacity:0;transition:all .3s}
.notif.show{transform:translateY(0);opacity:1}

/* FOOTER */
footer{text-align:center;padding:32px 0 8px;border-top:1px solid var(--border);margin-top:16px}
</style>
</head>
<body>
<div class="wrap">

  <!-- HEADER -->
  <header class="anim">
    <div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:center">
        <a class="back-btn" href="index.html" id="back-portal">‚Üê Portal</a>
        <a class="continue-btn back-btn" href="index.html" id="continue-btn" style="display:none">‚ñ∂ Continue</a>
      </div>
      <div class="hd-title">üìä Student Dashboard</div>
      <div class="hd-sub">Yor's Road to Reading Japanese Manga</div>
      <div class="hd-desc">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ¬∑ ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô ¬∑ ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
    </div>
    <div id="hdr-streak-badge" style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;margin-top:auto">
      <div style="display:flex;align-items:center;gap:10px;background:linear-gradient(135deg,rgba(212,168,58,.15),rgba(212,168,58,.05));border:1px solid rgba(212,168,58,.3);border-radius:14px;padding:10px 16px">
        <div style="font-size:22px" id="fire-icon">üíß</div>
        <div>
          <div style="font-family:'Shippori Mincho';font-size:28px;font-weight:800;color:var(--gold2);line-height:1" id="streak-num">0</div>
          <div style="font-size:10px;color:var(--gold);font-family:'DM Mono';letter-spacing:1px;text-transform:uppercase">Day Streak</div>
        </div>
      </div>
      <div style="font-size:11px;color:var(--text3);font-family:'DM Mono'" id="last-study-label">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
    </div>
  </header>

  <!-- OVERVIEW STATS -->
  <div class="section-label anim anim-1">üìà Overview</div>
  <div class="stat-row anim anim-1" id="stat-row">
    <!-- JS render -->
  </div>

  <!-- ACTIVITY HEATMAP -->
  <div class="section-wrap anim anim-2">
    <div class="section-label">üìÖ Activity Heatmap ‚Äî ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
    <div class="card">
      <div class="card-title">üóìÔ∏è 52 Weeks ‚Äî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô SRS</div>
      <div class="card-desc">‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠ 1 ‡∏ß‡∏±‡∏ô ¬∑ ‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ SRS Review</div>
      <div style="display:flex;gap:0">
        <div class="hm-day-labels" id="day-labels"></div>
        <div style="flex:1;overflow:visible;padding-top:30px;margin-top:-30px">
          <div class="hm-labels-months" id="month-labels"></div>
          <div class="heatmap-grid" id="heatmap-grid"></div>
        </div>
      </div>
      <div class="heatmap-footer">
        <span>‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤</span>
        <div class="hm-legend">
          <div class="hm-leg-cell" style="background:var(--surface2);border:1px solid rgba(255,255,255,.05)"></div>
          <div class="hm-leg-cell" style="background:rgba(232,84,122,.3)"></div>
          <div class="hm-leg-cell" style="background:rgba(232,84,122,.6)"></div>
          <div class="hm-leg-cell" style="background:var(--sakura)"></div>
        </div>
        <span>‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤</span>
        <span style="margin-left:auto;color:var(--text2)" id="hm-summary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
      </div>
    </div>
  </div>

  <!-- TWO COL: GRAMMAR + LAPSE -->
  <div class="two-col anim anim-3">

    <!-- GRAMMAR WEAK SECTIONS -->
    <div class="section-wrap">
      <div class="section-label">üéØ Grammar Weak Sections ‚Äî Stage 2</div>
      <div class="card">
        <div class="card-title">üìñ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô Grammar N5‚ÜíN4</div>
        <div class="card-desc">‡∏ö‡∏ó‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 70% ‡∏Ñ‡∏ß‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô</div>
        <div class="grammar-sections" id="grammar-sections">
          <div class="empty-state"><div class="icon">üìö</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grammar<br><small>‡πÑ‡∏õ‡∏ó‡∏≥ Quiz ‡∏ó‡∏µ‡πà Stage 2 ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞!</small></div>
        </div>
      </div>
    </div>

    <!-- LAPSE TRACKER -->
    <div class="section-wrap">
      <div class="section-label">üî¥ Lapse Tracker ‚Äî ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏•‡∏∑‡∏°‡∏ö‡πà‡∏≠‡∏¢</div>
      <div class="card">
        <div class="card-title">üíî ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏ã‡πâ‡∏≥‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
        <div class="card-desc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ ¬∑ ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ</div>
        <div class="lapse-list" id="lapse-list">
          <div class="empty-state"><div class="icon">‚ú®</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Lapse<br><small>‡πÑ‡∏õ‡∏ó‡∏≥ SRS Review ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞!</small></div>
        </div>
      </div>
    </div>

  </div><!-- end two-col -->

</div><!-- end wrap -->

<footer>
  <div style="font-family:'Shippori Mincho';font-size:20px;color:var(--sakura);font-weight:700;letter-spacing:2px">Yor</div>
  <div style="font-size:11px;color:var(--text3);font-family:'DM Mono';letter-spacing:3px;text-transform:uppercase;margin-top:4px">Student Dashboard ¬∑ Â≠¶ÁøíË®òÈå≤</div>
</footer>

<div class="notif" id="notif"></div>
<script src="firebase.js" type="module"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SMART BACK BUTTON
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initBackButton(){
  const from = sessionStorage.getItem('db_from') || 'portal';
  const map = {
    'portal':  { href: 'index.html',             label: '‚Üê Portal' },
    'stage1':  { href: 'japanese-learning.html', label: '‚Üê ‡∏Å‡∏•‡∏±‡∏ö Stage 1 (Kana)' },
    'stage2':  { href: 'grammar-stage2.html',    label: '‚Üê ‡∏Å‡∏•‡∏±‡∏ö Stage 2 (Grammar)' },
    'stage3':  { href: 'vocab-stage3.html',       label: '‚Üê ‡∏Å‡∏•‡∏±‡∏ö Stage 3 (Vocab)' },
  };
  const target = map[from] || map['portal'];
  const btn = document.getElementById('back-btn');
  if(btn){
    btn.href = target.href;
    btn.textContent = target.label;
    if(from !== 'portal'){
      btn.style.color = 'var(--sakura)';
      btn.style.borderColor = 'rgba(232,84,122,.4)';
      btn.style.background = 'rgba(232,84,122,.06)';
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VOCAB LOOKUP MAP (from Stage 3)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const VOCAB=[
// KAISHI
{id:'k001',jp:'‰∫∫',kana:'„Å≤„Å®',th:'‡∏Ñ‡∏ô, ‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå',type:'noun'},
{id:'k002',jp:'Êó•Êú¨',kana:'„Å´„Åª„Çì',th:'‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô (‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®)',type:'noun'},
{id:'k003',jp:'‰ªä',kana:'„ÅÑ„Åæ',th:'‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ, ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ',type:'adv'},
{id:'k004',jp:'‰Ωï',kana:'„Å™„Å´',th:'‡∏≠‡∏∞‡πÑ‡∏£',type:'noun'},
{id:'k005',jp:'Ë®Ä„ÅÜ',kana:'„ÅÑ„ÅÜ',th:'‡∏û‡∏π‡∏î, ‡∏ö‡∏≠‡∏Å',type:'verb'},
{id:'k006',jp:'Ë¶ã„Çã',kana:'„Åø„Çã',th:'‡∏î‡∏π, ‡∏°‡∏≠‡∏á',type:'verb'},
{id:'k007',jp:'Êù•„Çã',kana:'„Åè„Çã',th:'‡∏°‡∏≤',type:'verb'},
{id:'k008',jp:'Ë°å„Åè',kana:'„ÅÑ„Åè',th:'‡πÑ‡∏õ',type:'verb'},
{id:'k009',jp:'È£ü„Åπ„Çã',kana:'„Åü„Åπ„Çã',th:'‡∏Å‡∏¥‡∏ô',type:'verb'},
{id:'k010',jp:'È£≤„ÇÄ',kana:'„ÅÆ„ÇÄ',th:'‡∏î‡∏∑‡πà‡∏°',type:'verb'},
{id:'k011',jp:'Â§ß„Åç„ÅÑ',kana:'„Åä„Åä„Åç„ÅÑ',th:'‡πÉ‡∏´‡∏ç‡πà',type:'adj'},
{id:'k012',jp:'Â∞è„Åï„ÅÑ',kana:'„Å°„ÅÑ„Åï„ÅÑ',th:'‡πÄ‡∏•‡πá‡∏Å',type:'adj'},
{id:'k013',jp:'Â§ö„ÅÑ',kana:'„Åä„Åä„ÅÑ',th:'‡πÄ‡∏¢‡∏≠‡∏∞, ‡∏°‡∏≤‡∏Å',type:'adj'},
{id:'k014',jp:'Â∞ë„Å™„ÅÑ',kana:'„Åô„Åè„Å™„ÅÑ',th:'‡∏ô‡πâ‡∏≠‡∏¢',type:'adj'},
{id:'k015',jp:'Â•Ω„Åç',kana:'„Åô„Åç',th:'‡∏ä‡∏≠‡∏ö',type:'adj'},
{id:'k016',jp:'Â´å„ÅÑ',kana:'„Åç„Çâ„ÅÑ',th:'‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö, ‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î',type:'adj'},
{id:'k017',jp:'ËâØ„ÅÑ',kana:'„ÅÑ„ÅÑ',th:'‡∏î‡∏µ',type:'adj'},
{id:'k018',jp:'ÊÇ™„ÅÑ',kana:'„Çè„Çã„ÅÑ',th:'‡πÅ‡∏¢‡πà, ‡πÑ‡∏°‡πà‡∏î‡∏µ',type:'adj'},
{id:'k019',jp:'ÂàÜ„Åã„Çã',kana:'„Çè„Åã„Çã',th:'‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à, ‡∏£‡∏π‡πâ',type:'verb'},
{id:'k020',jp:'ÊÄù„ÅÜ',kana:'„Åä„ÇÇ„ÅÜ',th:'‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤, ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å',type:'verb'},
{id:'k021',jp:'ÊôÇÈñì',kana:'„Åò„Åã„Çì',th:'‡πÄ‡∏ß‡∏•‡∏≤',type:'noun'},
{id:'k022',jp:'Â†¥ÊâÄ',kana:'„Å∞„Åó„Çá',th:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà',type:'noun'},
{id:'k023',jp:'Ê∞óÊåÅ„Å°',kana:'„Åç„ÇÇ„Å°',th:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å',type:'noun'},
{id:'k024',jp:'Â£∞',kana:'„Åì„Åà',th:'‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô)',type:'noun'},
{id:'k025',jp:'È°î',kana:'„Åã„Åä',th:'‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤',type:'noun'},
{id:'k026',jp:'ÁõÆ',kana:'„ÇÅ',th:'‡∏ï‡∏≤',type:'noun'},
{id:'k027',jp:'Êâã',kana:'„Å¶',th:'‡∏°‡∏∑‡∏≠',type:'noun'},
{id:'k028',jp:'ÂøÉ',kana:'„Åì„Åì„Çç',th:'‡∏´‡∏±‡∏ß‡πÉ‡∏à, ‡∏à‡∏¥‡∏ï‡πÉ‡∏à',type:'noun'},
{id:'k029',jp:'Âäõ',kana:'„Å°„Åã„Çâ',th:'‡∏û‡∏•‡∏±‡∏á, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ',type:'noun'},
{id:'k030',jp:'Â§¢',kana:'„ÇÜ„ÇÅ',th:'‡∏ù‡∏±‡∏ô, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô',type:'noun'},
// N5
{id:'n001',jp:'ÁßÅ',kana:'„Çè„Åü„Åó',th:'‡∏â‡∏±‡∏ô (‡∏™‡∏∏‡∏†‡∏≤‡∏û)',type:'noun'},
{id:'n002',jp:'„ÅÇ„Å™„Åü',kana:'„ÅÇ„Å™„Åü',th:'‡∏Ñ‡∏∏‡∏ì',type:'noun'},
{id:'n003',jp:'ÂΩº',kana:'„Åã„Çå',th:'‡πÄ‡∏Ç‡∏≤ (‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢) / ‡πÅ‡∏ü‡∏ô',type:'noun'},
{id:'n004',jp:'ÂΩºÂ•≥',kana:'„Åã„ÅÆ„Åò„Çá',th:'‡πÄ‡∏ò‡∏≠ (‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á) / ‡πÅ‡∏ü‡∏ô',type:'noun'},
{id:'n005',jp:'ÂÆ∂Êóè',kana:'„Åã„Åû„Åè',th:'‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',type:'noun'},
{id:'n006',jp:'ÂèãÈÅî',kana:'„Å®„ÇÇ„Å†„Å°',th:'‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô',type:'noun'},
{id:'n007',jp:'ÂÖàÁîü',kana:'„Åõ„Çì„Åõ„ÅÑ',th:'‡∏Ñ‡∏£‡∏π, ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå',type:'noun'},
{id:'n008',jp:'Â≠¶Áîü',kana:'„Åå„Åè„Åõ„ÅÑ',th:'‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤',type:'noun'},
{id:'n009',jp:'Â≠¶Ê†°',kana:'„Åå„Å£„Åì„ÅÜ',th:'‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',type:'noun'},
{id:'n010',jp:'Êú¨',kana:'„Åª„Çì',th:'‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠',type:'noun'},
{id:'n011',jp:'Ëªä',kana:'„Åè„Çã„Åæ',th:'‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå',type:'noun'},
{id:'n012',jp:'ÈõªËªä',kana:'„Åß„Çì„Åó„ÇÉ',th:'‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤',type:'noun'},
{id:'n013',jp:'ÈßÖ',kana:'„Åà„Åç',th:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü',type:'noun'},
{id:'n014',jp:'Ê∞¥',kana:'„Åø„Åö',th:'‡∏ô‡πâ‡∏≥',type:'noun'},
{id:'n015',jp:'„Åä„ÅäÈáë',kana:'„Åä„Åã„Å≠',th:'‡πÄ‡∏á‡∏¥‡∏ô',type:'noun'},
{id:'n016',jp:'‰ªï‰∫ã',kana:'„Åó„Åî„Å®',th:'‡∏á‡∏≤‡∏ô, ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',type:'noun'},
{id:'n017',jp:'ÂêçÂâç',kana:'„Å™„Åæ„Åà',th:'‡∏ä‡∏∑‡πà‡∏≠',type:'noun'},
{id:'n018',jp:'Ë®ÄËëâ',kana:'„Åì„Å®„Å∞',th:'‡∏Ñ‡∏≥, ‡∏†‡∏≤‡∏©‡∏≤',type:'noun'},
{id:'n019',jp:'Ë©±„Åô',kana:'„ÅØ„Å™„Åô',th:'‡∏û‡∏π‡∏î, ‡∏Ñ‡∏∏‡∏¢',type:'verb'},
{id:'n020',jp:'Êõ∏„Åè',kana:'„Åã„Åè',th:'‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô',type:'verb'},
{id:'n021',jp:'Ë™≠„ÇÄ',kana:'„Çà„ÇÄ',th:'‡∏≠‡πà‡∏≤‡∏ô',type:'verb'},
{id:'n022',jp:'ËÅû„Åè',kana:'„Åç„Åè',th:'‡∏ü‡∏±‡∏á, ‡∏ñ‡∏≤‡∏°',type:'verb'},
{id:'n023',jp:'Ë≤∑„ÅÜ',kana:'„Åã„ÅÜ',th:'‡∏ã‡∏∑‡πâ‡∏≠',type:'verb'},
{id:'n024',jp:'‰Ωø„ÅÜ',kana:'„Å§„Åã„ÅÜ',th:'‡πÉ‡∏ä‡πâ',type:'verb'},
{id:'n025',jp:'‰Ωú„Çã',kana:'„Å§„Åè„Çã',th:'‡∏ó‡∏≥, ‡∏™‡∏£‡πâ‡∏≤‡∏á',type:'verb'},
{id:'n026',jp:'ÂæÖ„Å§',kana:'„Åæ„Å§',th:'‡∏£‡∏≠, ‡∏Ñ‡∏≠‡∏¢',type:'verb'},
{id:'n027',jp:'‰ºö„ÅÜ',kana:'„ÅÇ„ÅÜ',th:'‡∏û‡∏ö, ‡πÄ‡∏à‡∏≠',type:'verb'},
{id:'n028',jp:'Â∏∞„Çã',kana:'„Åã„Åà„Çã',th:'‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô',type:'verb'},
{id:'n029',jp:'Ëµ∑„Åç„Çã',kana:'„Åä„Åç„Çã',th:'‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô',type:'verb'},
{id:'n030',jp:'ÂØù„Çã',kana:'„Å≠„Çã',th:'‡∏ô‡∏≠‡∏ô, ‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö',type:'verb'},
{id:'n031',jp:'Êñ∞„Åó„ÅÑ',kana:'„ÅÇ„Åü„Çâ„Åó„ÅÑ',th:'‡πÉ‡∏´‡∏°‡πà',type:'adj'},
{id:'n032',jp:'Âè§„ÅÑ',kana:'„Åµ„Çã„ÅÑ',th:'‡πÄ‡∏Å‡πà‡∏≤',type:'adj'},
{id:'n033',jp:'È´ò„ÅÑ',kana:'„Åü„Åã„ÅÑ',th:'‡πÅ‡∏û‡∏á / ‡∏™‡∏π‡∏á',type:'adj'},
{id:'n034',jp:'ÂÆâ„ÅÑ',kana:'„ÇÑ„Åô„ÅÑ',th:'‡∏ñ‡∏π‡∏Å (‡∏£‡∏≤‡∏Ñ‡∏≤)',type:'adj'},
{id:'n035',jp:'‰ªäÊó•',kana:'„Åç„Çá„ÅÜ',th:'‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',type:'adv'},
{id:'n036',jp:'ÊòéÊó•',kana:'„ÅÇ„Åó„Åü',th:'‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ',type:'adv'},
{id:'n037',jp:'Êò®Êó•',kana:'„Åç„ÅÆ„ÅÜ',th:'‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô',type:'adv'},
{id:'n038',jp:'„ÇÇ„ÅÜ',kana:'„ÇÇ„ÅÜ',th:'‡πÅ‡∏•‡πâ‡∏ß / ‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß',type:'adv'},
{id:'n039',jp:'„Åæ„Å†',kana:'„Åæ„Å†',th:'‡∏¢‡∏±‡∏á‡∏Ñ‡∏á, ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà',type:'adv'},
{id:'n040',jp:'„Å®„Å¶„ÇÇ',kana:'„Å®„Å¶„ÇÇ',th:'‡∏°‡∏≤‡∏Å, ‡∏¢‡∏¥‡πà‡∏á‡∏ô‡∏±‡∏Å',type:'adv'},
// N4
{id:'f001',jp:'Ê±∫„ÇÅ„Çã',kana:'„Åç„ÇÅ„Çã',th:'‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à',type:'verb'},
{id:'f002',jp:'Âßã„ÇÅ„Çã',kana:'„ÅØ„Åò„ÇÅ„Çã',th:'‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô',type:'verb'},
{id:'f003',jp:'Á∂ö„Åë„Çã',kana:'„Å§„Å•„Åë„Çã',th:'‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡πÑ‡∏õ, ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á',type:'verb'},
{id:'f004',jp:'ÁµÇ„Çè„Çã',kana:'„Åä„Çè„Çã',th:'‡∏à‡∏ö, ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î',type:'verb'},
{id:'f005',jp:'Â§â„Çè„Çã',kana:'„Åã„Çè„Çã',th:'‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô',type:'verb'},
{id:'f006',jp:'ËÄÉ„Åà„Çã',kana:'„Åã„Çì„Åå„Åà„Çã',th:'‡∏Ñ‡∏¥‡∏î, ‡∏ï‡∏£‡∏∂‡∏Å‡∏ï‡∏£‡∏≠‡∏á',type:'verb'},
{id:'f007',jp:'ÊÑü„Åò„Çã',kana:'„Åã„Çì„Åò„Çã',th:'‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å',type:'verb'},
{id:'f008',jp:'Ê∞ó„Å•„Åè',kana:'„Åç„Å•„Åè',th:'‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏´‡πá‡∏ô, ‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å',type:'verb'},
{id:'f009',jp:'ÈÅ∏„Å∂',kana:'„Åà„Çâ„Å∂',th:'‡πÄ‡∏•‡∏∑‡∏≠‡∏Å',type:'verb'},
{id:'f010',jp:'Ë™ø„Åπ„Çã',kana:'„Åó„Çâ„Åπ„Çã',th:'‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',type:'verb'},
{id:'f011',jp:'Ë™¨Êòé„Åô„Çã',kana:'„Åõ„Å§„ÇÅ„ÅÑ„Åô„Çã',th:'‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢',type:'verb'},
{id:'f012',jp:'Á∑¥Áøí„Åô„Çã',kana:'„Çå„Çì„Åó„ÇÖ„ÅÜ„Åô„Çã',th:'‡∏ù‡∏∂‡∏Å‡∏ã‡πâ‡∏≠‡∏°',type:'verb'},
{id:'f013',jp:'Ê∫ñÂÇô„Åô„Çã',kana:'„Åò„ÇÖ„Çì„Å≥„Åô„Çã',th:'‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°',type:'verb'},
{id:'f014',jp:'ÂøÉÈÖç„Åô„Çã',kana:'„Åó„Çì„Å±„ÅÑ„Åô„Çã',th:'‡∏Å‡∏±‡∏á‡∏ß‡∏•, ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πà‡∏ß‡∏á',type:'verb'},
{id:'f015',jp:'Â§ßÂàá„Å™',kana:'„Åü„ÅÑ„Åõ„Å§„Å™',th:'‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç, ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤',type:'adj'},
{id:'f016',jp:'ÂøÖË¶Å„Å™',kana:'„Å≤„Å§„Çà„ÅÜ„Å™',th:'‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',type:'adj'},
{id:'f017',jp:'‰æøÂà©„Å™',kana:'„Åπ„Çì„Çä„Å™',th:'‡∏™‡∏∞‡∏î‡∏ß‡∏Å',type:'adj'},
{id:'f018',jp:'ÁâπÂà•„Å™',kana:'„Å®„Åè„Åπ„Å§„Å™',th:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',type:'adj'},
{id:'f019',jp:'ÊôÆÈÄö',kana:'„Åµ„Å§„ÅÜ',th:'‡∏õ‡∏Å‡∏ï‡∏¥, ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',type:'adv'},
{id:'f020',jp:'ÊúÄËøë',kana:'„Åï„ÅÑ„Åç„Çì',th:'‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ, ‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ',type:'adv'},
{id:'f021',jp:'„ÇÇ„Å°„Çç„Çì',kana:'„ÇÇ„Å°„Çç„Çì',th:'‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô, ‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏™‡∏¥',type:'adv'},
{id:'f022',jp:'„ÇÑ„Å£„Å±„Çä',kana:'„ÇÑ„Å£„Å±„Çä',th:'‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î, ‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°',type:'adv'},
{id:'f023',jp:'ÁµåÈ®ì',kana:'„Åë„ÅÑ„Åë„Çì',th:'‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå',type:'noun'},
{id:'f024',jp:'ÊÑèÂë≥',kana:'„ÅÑ„Åø',th:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢',type:'noun'},
{id:'f025',jp:'ÁêÜÁî±',kana:'„Çä„ÇÜ„ÅÜ',th:'‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•',type:'noun'},
{id:'f026',jp:'ÂïèÈ°å',kana:'„ÇÇ„Çì„Å†„ÅÑ',th:'‡∏õ‡∏±‡∏ç‡∏´‡∏≤, ‡πÇ‡∏à‡∏ó‡∏¢‡πå',type:'noun'},
{id:'f027',jp:'Á≠î„Åà',kana:'„Åì„Åü„Åà',th:'‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö',type:'noun'},
{id:'f028',jp:'ÊñáÂåñ',kana:'„Å∂„Çì„Åã',th:'‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°',type:'noun'},
{id:'f029',jp:'Á§æ‰ºö',kana:'„Åó„ÇÉ„Åã„ÅÑ',th:'‡∏™‡∏±‡∏á‡∏Ñ‡∏°',type:'noun'},
{id:'f030',jp:'Ê©ü‰ºö',kana:'„Åç„Åã„ÅÑ',th:'‡πÇ‡∏≠‡∏Å‡∏≤‡∏™',type:'noun'},
// MANGA
{id:'m001',jp:'Êïµ',kana:'„Å¶„Åç',th:'‡∏®‡∏±‡∏ï‡∏£‡∏π, ‡∏Ç‡πâ‡∏≤‡∏®‡∏∂‡∏Å',type:'noun'},
{id:'m002',jp:'‰ª≤Èñì',kana:'„Å™„Åã„Åæ',th:'‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤, ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡∏°',type:'noun'},
{id:'m003',jp:'Â∏åÊúõ',kana:'„Åç„Åº„ÅÜ',th:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á',type:'noun'},
{id:'m004',jp:'ÈÅãÂëΩ',kana:'„ÅÜ„Çì„ÇÅ„ÅÑ',th:'‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤, ‡∏ä‡∏∞‡∏ï‡∏≤‡∏Å‡∏£‡∏£‡∏°',type:'noun'},
{id:'m005',jp:'Ë¶öÊÇü',kana:'„Åã„Åè„Åî',th:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô, ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏à‡∏£‡∏¥‡∏á',type:'noun'},
{id:'m006',jp:'Á¥ÑÊùü',kana:'„ÇÑ„Åè„Åù„Åè',th:'‡∏™‡∏±‡∏ç‡∏ç‡∏≤, ‡∏ô‡∏±‡∏î',type:'noun'},
{id:'m007',jp:'Êà¶„ÅÜ',kana:'„Åü„Åü„Åã„ÅÜ',th:'‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ',type:'verb'},
{id:'m008',jp:'ÂÆà„Çã',kana:'„Åæ„ÇÇ„Çã',th:'‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á, ‡∏£‡∏±‡∏Å‡∏©‡∏≤',type:'verb'},
{id:'m009',jp:'‰ø°„Åò„Çã',kana:'„Åó„Çì„Åò„Çã',th:'‡πÄ‡∏ä‡∏∑‡πà‡∏≠, ‡πÑ‡∏ß‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏à',type:'verb'},
{id:'m010',jp:'Ë´¶„ÇÅ„Çã',kana:'„ÅÇ„Åç„Çâ„ÇÅ„Çã',th:'‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ, ‡∏ó‡∏≠‡∏î‡∏ó‡∏¥‡πâ‡∏á',type:'verb'},
{id:'m011',jp:'Âä©„Åë„Çã',kana:'„Åü„Åô„Åë„Çã',th:'‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠',type:'verb'},
{id:'m012',jp:'Âãù„Å§',kana:'„Åã„Å§',th:'‡∏ä‡∏ô‡∏∞',type:'verb'},
{id:'m013',jp:'Ë≤†„Åë„Çã',kana:'„Åæ„Åë„Çã',th:'‡πÅ‡∏û‡πâ',type:'verb'},
{id:'m014',jp:'Âº∑„ÅÑ',kana:'„Å§„Çà„ÅÑ',th:'‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á, ‡πÄ‡∏Å‡πà‡∏á',type:'adj'},
{id:'m015',jp:'Âº±„ÅÑ',kana:'„Çà„Çè„ÅÑ',th:'‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠',type:'adj'},
{id:'m016',jp:'„Åã„Å£„Åì„ÅÑ„ÅÑ',kana:'„Åã„Å£„Åì„ÅÑ„ÅÑ',th:'‡πÄ‡∏ó‡πà, ‡∏´‡∏•‡πà‡∏≠',type:'adj'},
{id:'m017',jp:'„ÇÑ„Å∞„ÅÑ',kana:'„ÇÑ„Å∞„ÅÑ',th:'‡πÇ‡∏´‡∏î!, ‡πÄ‡∏à‡πã‡∏á! (‡∏™‡πÅ‡∏•‡∏á)',type:'expr'},
{id:'m018',jp:'„Å™„Çã„Åª„Å©',kana:'„Å™„Çã„Åª„Å©',th:'‡∏≠‡∏≠, ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',type:'expr'},
{id:'m019',jp:'„Åï„Åô„Åå',kana:'„Åï„Åô„Åå',th:'‡πÄ‡∏Å‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÜ, ‡πÑ‡∏°‡πà‡πÅ‡∏õ‡∏•‡∏Å‡πÉ‡∏à',type:'expr'},
{id:'m020',jp:'Êú¨ÂΩì„Å´',kana:'„Åª„Çì„Å®„ÅÜ„Å´',th:'‡∏à‡∏£‡∏¥‡∏á‡πÜ, ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á',type:'adv'},
{id:'m021',jp:'Áµ∂ÂØæ„Å´',kana:'„Åú„Å£„Åü„ÅÑ„Å´',th:'‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î, ‡∏ï‡πâ‡∏≠‡∏á',type:'adv'},
{id:'m022',jp:'„Åæ„Åò„Åß',kana:'„Åæ„Åò„Åß',th:'‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏´‡∏£‡∏≠? (‡∏™‡πÅ‡∏•‡∏á)',type:'expr'},
{id:'m023',jp:'„ÅÜ„Åù',kana:'„ÅÜ„Åù',th:'‡πÇ‡∏Å‡∏´‡∏Å / "‡πÑ‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á‡∏ô‡∏∞!"',type:'expr'},
{id:'m024',jp:'Ê≠ª„Å¨',kana:'„Åó„Å¨',th:'‡∏ï‡∏≤‡∏¢',type:'verb'},
{id:'m025',jp:'Áîü„Åç„Çã',kana:'„ÅÑ„Åç„Çã',th:'‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡∏π‡πà',type:'verb'},
// DAILY LIFE
{id:'d001',jp:'È£ü„ÅπÁâ©',kana:'„Åü„Åπ„ÇÇ„ÅÆ',th:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£',type:'noun'},
{id:'d002',jp:'È£≤„ÅøÁâ©',kana:'„ÅÆ„Åø„ÇÇ„ÅÆ',th:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°',type:'noun'},
{id:'d003',jp:'Â∫ó',kana:'„Åø„Åõ',th:'‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤',type:'noun'},
{id:'d004',jp:'ÁóÖÈô¢',kana:'„Å≥„Çá„ÅÜ„ÅÑ„Çì',th:'‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•',type:'noun'},
{id:'d005',jp:'ÈäÄË°å',kana:'„Åé„Çì„Åì„ÅÜ',th:'‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£',type:'noun'},
{id:'d006',jp:'‰ºöÁ§æ',kana:'„Åã„ÅÑ„Åó„ÇÉ',th:'‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó',type:'noun'},
{id:'d007',jp:'ÈõªË©±',kana:'„Åß„Çì„Çè',th:'‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå',type:'noun'},
{id:'d008',jp:'Â§©Ê∞ó',kana:'„Å¶„Çì„Åç',th:'‡∏≠‡∏≤‡∏Å‡∏≤‡∏®, ‡∏î‡∏¥‡∏ô‡∏ü‡πâ‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏®',type:'noun'},
{id:'d009',jp:'ÊñôÁêÜ',kana:'„Çä„Çá„ÅÜ„Çä',th:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏Å‡∏≤‡∏£‡∏ó‡∏≥) / ‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£',type:'noun'},
{id:'d010',jp:'ÊóÖË°å',kana:'„Çä„Çá„Åì„ÅÜ',th:'‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß',type:'noun'},
{id:'d011',jp:'Èü≥Ê•Ω',kana:'„Åä„Çì„Åå„Åè',th:'‡∏î‡∏ô‡∏ï‡∏£‡∏µ',type:'noun'},
{id:'d012',jp:'Êò†Áîª',kana:'„Åà„ÅÑ„Åå',th:'‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå',type:'noun'},
{id:'d013',jp:'„Çπ„Éù„Éº„ÉÑ',kana:'„Çπ„Éù„Éº„ÉÑ',th:'‡∏Å‡∏µ‡∏¨‡∏≤',type:'noun'},
{id:'d014',jp:'Ë≤∑„ÅÑÁâ©',kana:'„Åã„ÅÑ„ÇÇ„ÅÆ',th:'‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á, ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á',type:'noun'},
{id:'d015',jp:'Êï£Ê≠©',kana:'„Åï„Çì„ÅΩ',th:'‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô',type:'noun'},
{id:'d016',jp:'Êöë„ÅÑ',kana:'„ÅÇ„Å§„ÅÑ',th:'‡∏£‡πâ‡∏≠‡∏ô (‡∏≠‡∏≤‡∏Å‡∏≤‡∏®)',type:'adj'},
{id:'d017',jp:'ÂØí„ÅÑ',kana:'„Åï„ÇÄ„ÅÑ',th:'‡∏´‡∏ô‡∏≤‡∏ß',type:'adj'},
{id:'d018',jp:'Áñ≤„Çå„Çã',kana:'„Å§„Åã„Çå„Çã',th:'‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢, ‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢',type:'verb'},
{id:'d019',jp:'Âøò„Çå„Çã',kana:'„Çè„Åô„Çå„Çã',th:'‡∏•‡∏∑‡∏°',type:'verb'},
{id:'d020',jp:'Ë¶ö„Åà„Çã',kana:'„Åä„Åº„Åà„Çã',th:'‡∏à‡∏≥, ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ',type:'verb'},
{id:'d021',jp:'ÊÄ•„Åê',kana:'„ÅÑ„Åù„Åê',th:'‡∏£‡∏µ‡∏ö, ‡πÄ‡∏£‡πà‡∏á‡∏£‡∏µ‡∏ö',type:'verb'},
{id:'d022',jp:'Âõ∞„Çã',kana:'„Åì„Åæ„Çã',th:'‡∏•‡∏≥‡∏ö‡∏≤‡∏Å, ‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô',type:'verb'},
{id:'d023',jp:'Ê•Ω„Åó„ÅÑ',kana:'„Åü„ÅÆ„Åó„ÅÑ',th:'‡∏™‡∏ô‡∏∏‡∏Å, ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç',type:'adj'},
{id:'d024',jp:'Â¨â„Åó„ÅÑ',kana:'„ÅÜ„Çå„Åó„ÅÑ',th:'‡∏î‡∏µ‡πÉ‡∏à, ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç',type:'adj'},
{id:'d025',jp:'ÊÇ≤„Åó„ÅÑ',kana:'„Åã„Å™„Åó„ÅÑ',th:'‡πÄ‡∏®‡∏£‡πâ‡∏≤',type:'adj'},
];
const VOCAB_MAP={};VOCAB.forEach(v=>{VOCAB_MAP[v.id]=v;});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA LOADERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadSRS(){
  try{return JSON.parse(localStorage.getItem('vd_srs')||'{}');}catch(e){return {};}
}
function loadStats(){
  try{
    const raw=localStorage.getItem('vd_stats');
    if(raw) return JSON.parse(raw);
  }catch(e){}
  return {streak:0,lastDate:'',totalSeen:0,reviewed:0,dailyReviewed:0,history:[]};
}
function loadGrammar(){
  try{return JSON.parse(localStorage.getItem('gd_p')||'{}');}catch(e){return {};}
}
function loadS1(){
  return {
    hiraLearned: (() => { try{return JSON.parse(localStorage.getItem('hiraLearned')||'[]').length;}catch(e){return 0;}})(),
    kataLearned: (() => { try{return JSON.parse(localStorage.getItem('kataLearned')||'[]').length;}catch(e){return 0;}})(),
    kanjiKnown:  (() => { try{return JSON.parse(localStorage.getItem('kanjiKnown')||'[]').length;}catch(e){return 0;}})(),
  };
}
function todayStr(){return new Date().toISOString().slice(0,10);}
function getStreak(){
  const st=loadStats();const td=todayStr();
  const yest=new Date(Date.now()-86400000).toISOString().slice(0,10);
  if(st.lastDate===td||st.lastDate===yest) return st.streak||0;
  return 0;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER OVERVIEW STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStats(){
  const srs=loadSRS();const st=loadStats();const s1=loadS1();const gp=loadGrammar();
  const cards=Object.values(srs);
  const learned=cards.filter(c=>c.reps>0).length;
  const mature=cards.filter(c=>c.state==='mature').length;
  const due=cards.filter(c=>c.due<=Date.now()&&c.state!=='new').length;
  const lapsedCards=cards.filter(c=>c.lapses>0);
  const totalLapses=lapsedCards.reduce((a,c)=>a+c.lapses,0);
  const streak=getStreak();
  const grammarSections=['verb','part','nai','cond','end'];
  const grammarVals=grammarSections.map(k=>gp[k]||0);
  const grammarAvg=Math.round(grammarVals.reduce((a,b)=>a+b,0)/grammarSections.length);
  const s1pct=Math.round((s1.hiraLearned/46+s1.kataLearned/46+Math.min(1,s1.kanjiKnown/80))/3*100);
  const s3pct=Math.round(learned/150*100);
  const overall=Math.round((s1pct*0.3+grammarAvg*0.3+s3pct*0.4));

  // Streak display
  document.getElementById('streak-num').textContent=streak;
  document.getElementById('fire-icon').textContent=streak>=7?'üî•':streak>=3?'‚ú®':'üíß';
  if(st.lastDate){
    const d=new Date(st.lastDate);
    document.getElementById('last-study-label').textContent='‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: '+d.toLocaleDateString('th-TH',{month:'short',day:'numeric'});
  }

  const stats=[
    {num:overall+'%',lbl:'Overall Progress',sub:`S1:${s1pct}% ¬∑ S2:${grammarAvg}% ¬∑ S3:${s3pct}%`,cls:'sc-sakura',color:'var(--sakura)'},
    {num:learned,lbl:'Vocab Learned',sub:`‡∏à‡∏≤‡∏Å 150 ‡∏Ñ‡∏≥ ¬∑ Mature: ${mature}`,cls:'sc-jade',color:'var(--jade2)'},
    {num:due,lbl:'Due Today',sub:due>0?'‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß!':'‡πÑ‡∏°‡πà‡∏°‡∏µ card ‡∏Ñ‡πâ‡∏≤‡∏á üéâ',cls:'sc-blue',color:'var(--blue)'},
    {num:totalLapses,lbl:'Total Lapses',sub:`${lapsedCards.length} ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ú‡∏¥‡∏î`,cls:'sc-sakura',color:'var(--red2)'},
    {num:streak,lbl:'Day Streak',sub:streak>=7?'üî• ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!':streak>=1?'‚ú® ‡∏™‡∏π‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ!':'üíß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',cls:'sc-gold',color:'var(--gold2)'},
  ];
  const el=document.getElementById('stat-row');
  el.innerHTML=stats.map(s=>`
    <div class="stat-card ${s.cls}">
      <div class="stat-num" style="color:${s.color}">${s.num}</div>
      <div class="stat-lbl">${s.lbl}</div>
      <div class="stat-sub">${s.sub}</div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER HEATMAP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHeatmap(){
  const st=loadStats();
  const history=new Set(st.history||[]);
  const today=new Date();
  today.setHours(0,0,0,0);
  const WEEKS=52;
  // Start: Sunday 52 weeks ago
  const start=new Date(today);
  start.setDate(start.getDate()-((WEEKS*7)-1));
  // Snap to Sunday
  const dow=start.getDay();
  start.setDate(start.getDate()-dow);
  const DAYS_TOTAL=WEEKS*7;

  // Month labels
  const monthEl=document.getElementById('month-labels');
  monthEl.style.position='relative';monthEl.style.height='14px';
  const months=[];
  let cur=new Date(start);
  for(let w=0;w<WEEKS;w++){
    const d=new Date(cur);d.setDate(d.getDate()+w*7);
    const m=d.getMonth();
    if(w===0||d.getDate()<=7){
      months.push({m,w});
    }
  }
  const CELL=16;// cell + gap
  monthEl.innerHTML=months.map(({m,w})=>`
    <span class="hm-month-label" style="left:${w*CELL}px">
      ${'JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC'.substring(m*3,m*3+3)}
    </span>`).join('');

  // Day labels (Mon, Wed, Fri)
  const dayEl=document.getElementById('day-labels');
  const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  dayEl.innerHTML=dayNames.map((d,i)=>`
    <div class="hm-day-label">${(i%2===1)?d:''}</div>`).join('');

  // Grid
  const gridEl=document.getElementById('heatmap-grid');
  gridEl.innerHTML='';
  let studiedCount=0;
  const oneMonth=30*24*3600*1000;

  for(let w=0;w<WEEKS;w++){
    const col=document.createElement('div');
    col.className='hm-col';
    for(let d=0;d<7;d++){
      const cellDate=new Date(start);
      cellDate.setDate(cellDate.getDate()+w*7+d);
      if(cellDate>today) {
        const blank=document.createElement('div');
        blank.style.cssText='width:13px;height:13px;flex-shrink:0';
        col.appendChild(blank);
        continue;
      }
      const dateStr=cellDate.toISOString().slice(0,10);
      const isStudied=history.has(dateStr);
      const isToday=dateStr===todayStr();
      const isRecent=(today-cellDate)<oneMonth;
      if(isStudied)studiedCount++;

      const cell=document.createElement('div');
      const rowTop = d <= 1 ? ' row-top' : '';
      cell.className='hm-cell'+rowTop+(isStudied?(isRecent?' studied-recent':' studied'):'');
      if(isToday){cell.style.outline='2px solid var(--gold)';cell.style.outlineOffset='1px';}

      // Tooltip
      const friendly=cellDate.toLocaleDateString('th-TH',{weekday:'short',day:'numeric',month:'short'});
      cell.innerHTML=`<div class="hm-tooltip">${friendly}${isStudied?' ¬∑ ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß':''}</div>`;
      col.appendChild(cell);
    }
    gridEl.appendChild(col);
  }

  // Summary
  document.getElementById('hm-summary').textContent=`‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${studiedCount} ‡∏ß‡∏±‡∏ô ‡∏à‡∏≤‡∏Å ${WEEKS} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER GRAMMAR WEAK SECTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderGrammar(){
  const gp=loadGrammar();
  const sections=[
    {key:'verb',name:'Verb Conjugation',jp:'ÂãïË©ûÊ¥ªÁî®',tips:{high:'‡∏ú‡∏±‡∏ô‡∏Å‡∏£‡∏¥‡∏¢‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß! üéâ',mid:'‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å „Å¶-form ‡πÅ‡∏•‡∏∞ „Åü-form ‡πÄ‡∏û‡∏¥‡πà‡∏°',low:'‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1 (‡∏ú‡∏±‡∏ô -„Çã/-„ÅÜ) ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞'}},
    {key:'part',name:'Particles',jp:'Âä©Ë©û',tips:{high:'‡πÉ‡∏ä‡πâ particle ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å! üåü',mid:'‡∏´‡∏°‡∏±‡πà‡∏ô‡∏ù‡∏∂‡∏Å „ÅØ vs „Åå vs „Çí ‡∏ö‡πà‡∏≠‡∏¢‡πÜ',low:'Particle ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏î‡πà‡∏ß‡∏ô!'}},
    {key:'nai',name:'„Å™„ÅÑ/„Åü„ÅÑ Form',jp:'„Å™„ÅÑÂΩ¢„Éª„Åü„ÅÑÂΩ¢',tips:{high:'Negative + Desire forms ‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‚ú®',mid:'‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ÔΩû„Åü„Åè„Å™„ÅÑ ‡πÄ‡∏û‡∏¥‡πà‡∏°',low:'‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å negative form ‡πÉ‡∏´‡πâ‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡πà‡∏≠‡∏ô'}},
    {key:'cond',name:'Conditionals',jp:'Êù°‰ª∂ÂΩ¢',tips:{high:'‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß! üí™',mid:'‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á „Åü„Çâ vs „Å® vs „Å∞',low:'Conditional ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏ù‡∏∂‡∏Å‡∏ó‡∏µ‡∏•‡∏∞‡∏≠‡∏±‡∏ô'}},
    {key:'end',name:'Sentence Endings',jp:'ÊñáÊú´Ë°®Áèæ',tips:{high:'‡∏à‡∏ö‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏≤‡∏Å! üî•',mid:'‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å „Çì„Åß„Åô / „ÅÆ„Åß„Åô ‡πÄ‡∏û‡∏¥‡πà‡∏°',low:'‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å ÔΩû„Å≠, ÔΩû„Çà, ÔΩû„Åë„Å© ‡πÉ‡∏ô‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5'}},
  ];

  const el=document.getElementById('grammar-sections');
  const hasData=sections.some(s=>(gp[s.key]||0)>0);
  if(!hasData){
    el.innerHTML=`<div class="empty-state"><div class="icon">üìö</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grammar<br><small>‡πÑ‡∏õ‡∏ó‡∏≥ Quiz ‡∏ó‡∏µ‡πà Stage 2 ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞!</small></div>`;
    return;
  }

  el.innerHTML=sections.map(s=>{
    const val=gp[s.key]||0;
    let color,badge,tip;
    if(val>=70){color='var(--jade2)';badge='badge-great';const b='GREAT';}
    else if(val>=40){color='var(--gold2)';badge='badge-ok';}
    else{color='var(--red2)';badge='badge-weak';}
    const badgeText=val>=70?'GREAT':val>=40?'OK':'WEAK';
    tip=val>=70?s.tips.high:val>=40?s.tips.mid:s.tips.low;

    return `
    <div class="gs-row">
      <div class="gs-header">
        <div class="gs-name">
          <span>${s.name}</span>
          <span style="font-family:'Shippori Mincho';font-size:11px;color:var(--text3)">${s.jp}</span>
          <span class="gs-badge ${badge}">${badgeText}</span>
        </div>
        <div class="gs-pct" style="color:${color}">${val}%</div>
      </div>
      <div class="gs-bar">
        <div class="gs-fill" style="width:${val}%;background:linear-gradient(90deg,${color}88,${color})"></div>
      </div>
      <div class="gs-tip">üí° ${tip}</div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER LAPSE TRACKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderLapseTracker(){
  const srs=loadSRS();
  const lapsed=Object.entries(srs)
    .filter(([,c])=>c.lapses>0)
    .map(([id,c])=>({id,lapses:c.lapses,state:c.state,reps:c.reps}))
    .sort((a,b)=>b.lapses-a.lapses)
    .slice(0,10);

  const el=document.getElementById('lapse-list');
  if(lapsed.length===0){
    el.innerHTML=`
      <div class="lapse-empty">
        <div class="icon">‚ú®</div>
        <div class="msg">‡πÑ‡∏°‡πà‡∏°‡∏µ Lapse ‡πÄ‡∏•‡∏¢!</div>
        <div class="sub">‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Äî ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å üéâ</div>
      </div>`;
    return;
  }

  const maxLapses=lapsed[0].lapses;
  const rankEmoji=['ü•á','ü•à','ü•â'];
  const stateColors={learning:'var(--gold)',young:'var(--jade2)',mature:'var(--text2)',new:'var(--blue)'};
  const lineColors=['var(--red2)','var(--sakura)','var(--gold2)'];

  el.innerHTML=lapsed.map((item,i)=>{
    const vocab=VOCAB_MAP[item.id];
    const jp=vocab?vocab.jp:item.id;
    const kana=vocab?vocab.kana:'?';
    const th=vocab?vocab.th:'?';
    const type=vocab?vocab.type:'noun';
    const pct=Math.round(item.lapses/maxLapses*100);
    const rankStr=i<3?rankEmoji[i]:`${i+1}.`;
    const stateCol=stateColors[item.state]||'var(--text3)';
    const lineCol=i<3?lineColors[i]:'var(--border2)';
    const lapseColor=item.lapses>=5?'var(--red2)':item.lapses>=3?'var(--gold2)':'var(--text2)';

    return `
    <div class="lapse-row" style="--line-col:${lineCol}">
      <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:${lineCol};border-radius:2px 0 0 2px"></div>
      <div class="lapse-rank ${i<3?'top3':''}" style="color:${lineCol}">${rankStr}</div>
      <div class="lapse-jp">${jp}</div>
      <div style="flex:1;min-width:0">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:2px">
          <div class="lapse-kana">${kana}</div>
          <div class="lapse-type tag-${type}">${type}</div>
          <div style="font-size:9px;font-family:'DM Mono';color:${stateCol};margin-left:auto">${item.state}</div>
        </div>
        <div class="lapse-th">${th}</div>
        <div style="margin-top:5px;height:2px;background:var(--border);border-radius:1px;overflow:hidden">
          <div style="height:100%;width:${pct}%;background:${lapseColor};border-radius:1px;transition:width .6s"></div>
        </div>
      </div>
      <div class="lapse-count" style="color:${lapseColor}">
        ${item.lapses}x
        <div style="font-size:8px;color:var(--text3);text-align:right">${item.reps} reps</div>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init(){
  initBackButton();
  renderStats();
  renderHeatmap();
  renderGrammar();
  renderLapseTracker();
}

// Smart Continue button
function setupContinueBtn(){
  const lastPage = localStorage.getItem('lastPage');
  const pageNames = {
    'japanese-learning.html': '‚¨Ö Stage 1 ‚Äî Kana & Kanji',
    'grammar-stage2.html':    '‚¨Ö Stage 2 ‚Äî Grammar',
    'vocab-stage3.html':      '‚¨Ö Stage 3 ‚Äî Vocabulary',
    'index.html':             '‚Üê Portal',
  };
  const btn = document.getElementById('continue-btn');
  const portalBtn = document.getElementById('back-portal');
  if(btn && lastPage && lastPage !== 'index.html' && pageNames[lastPage]){
    btn.href = lastPage;
    btn.innerHTML = '‚ñ∂ Continue ‚Äî ' + {
      'japanese-learning.html': 'Stage 1 Kana',
      'grammar-stage2.html':    'Stage 2 Grammar',
      'vocab-stage3.html':      'Stage 3 Vocab',
    }[lastPage];
    btn.style.display = 'inline-flex';
    if(portalBtn) portalBtn.style.display = 'inline-flex';
  }
}

// Wait for Firebase (if loaded) then init
window.addEventListener('load', ()=>{
  // Small delay to let firebase.js pull from cloud
  setTimeout(()=>{init();setupContinueBtn();}, 800);
});

// Also re-render when firebase pulls data
window.addEventListener('fb-data-loaded', init);
</script>
</body>
</html>
